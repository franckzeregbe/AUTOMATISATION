<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final - Bible AUTOMATISATION</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; }
        .test-section { background: rgba(255,255,255,0.1); padding: 20px; margin: 15px 0; border-radius: 10px; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        button { background: #6a11cb; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2575fc; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ðŸ”¬ Test Final - Section Bible AUTOMATISATION</h1>
    
    <div class="test-section">
        <h2>ðŸ“š Tests Disponibles</h2>
        <button onclick="testBibleData()">Test DonnÃ©es Bible</button>
        <button onclick="testSyncManager()">Test Synchronisation</button>
        <button onclick="testFavorites()">Test Favoris</button>
        <button onclick="testNotes()">Test Notes</button>
        <button onclick="testAPI()">Test API Bible</button>
        <button onclick="runAllTests()">ðŸš€ Tous les Tests</button>
    </div>

    <div id="results"></div>

    <script src="bible-data.js"></script>
    <script src="sync-manager.js"></script>
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            document.getElementById('results').appendChild(div);
        }

        async function testBibleData() {
            log('ðŸ” Test des donnÃ©es Bible...', 'info');
            
            if (typeof loadBibleData === 'function') {
                const loaded = await loadBibleData();
                if (loaded) {
                    log('âœ… DonnÃ©es Bible chargÃ©es avec succÃ¨s', 'success');
                    
                    const lsgBooks = Object.keys(window.bibleData.lsg || {});
                    const darbyBooks = Object.keys(window.bibleData.darby || {});
                    
                    log(`ðŸ“– LSG: ${lsgBooks.length} livres (${lsgBooks.slice(0,5).join(', ')}...)`, 'info');
                    log(`ðŸ“– Darby: ${darbyBooks.length} livres (${darbyBooks.slice(0,5).join(', ')}...)`, 'info');
                } else {
                    log('âŒ Erreur lors du chargement des donnÃ©es Bible', 'error');
                }
            } else {
                log('âŒ Fonction loadBibleData non trouvÃ©e', 'error');
            }
        }

        function testSyncManager() {
            log('ðŸ”„ Test du gestionnaire de synchronisation...', 'info');
            
            if (typeof window.syncManager !== 'undefined') {
                log('âœ… SyncManager initialisÃ©', 'success');
                
                const status = window.syncManager.getSyncStatus();
                log(`ðŸ“¡ Statut: ${status.isOnline ? 'En ligne' : 'Hors ligne'}`, 'info');
                log(`ðŸ“Š Queue: ${status.queueLength} Ã©lÃ©ments`, 'info');
                log(`ðŸ•’ DerniÃ¨re sync: ${status.lastSync || 'Jamais'}`, 'info');
            } else {
                log('âŒ SyncManager non trouvÃ©', 'error');
            }
        }

        function testFavorites() {
            log('â­ Test du systÃ¨me de favoris...', 'info');
            
            // Simuler l'ajout d'un favori
            const testFavorite = {
                id: 'test_fav',
                book: 'Jean',
                chapter: 3,
                verse: 16,
                text: 'Car Dieu a tant aimÃ© le monde...',
                date: new Date().toISOString()
            };
            
            const favorites = [testFavorite];
            localStorage.setItem('bibleFavorites_test', JSON.stringify(favorites));
            
            const saved = JSON.parse(localStorage.getItem('bibleFavorites_test'));
            if (saved && saved.length > 0) {
                log('âœ… SystÃ¨me de favoris fonctionnel', 'success');
                log(`ðŸ“ Favori test: ${saved[0].book} ${saved[0].chapter}:${saved[0].verse}`, 'info');
            } else {
                log('âŒ Erreur systÃ¨me de favoris', 'error');
            }
        }

        function testNotes() {
            log('ðŸ“ Test du systÃ¨me de notes...', 'info');
            
            const testNote = {
                id: 'test_note',
                book: 'Psaume',
                chapter: 23,
                verse: 1,
                text: 'L\'Ã‰ternel est mon berger...',
                note: 'Note de test - trÃ¨s inspirant!',
                date: new Date().toISOString()
            };
            
            const notes = [testNote];
            localStorage.setItem('bibleNotes_test', JSON.stringify(notes));
            
            const saved = JSON.parse(localStorage.getItem('bibleNotes_test'));
            if (saved && saved.length > 0) {
                log('âœ… SystÃ¨me de notes fonctionnel', 'success');
                log(`ðŸ“ Note test: ${saved[0].book} ${saved[0].chapter}:${saved[0].verse}`, 'info');
            } else {
                log('âŒ Erreur systÃ¨me de notes', 'error');
            }
        }

        async function testAPI() {
            log('ðŸŒ Test de l\'API Bible...', 'info');
            
            if (typeof fetchFromBibleAPI === 'function') {
                try {
                    const verses = await fetchFromBibleAPI('JHN', 3);
                    if (verses && verses.length > 0) {
                        log('âœ… API Bible accessible', 'success');
                        log(`ðŸ“– RÃ©cupÃ©rÃ©: ${verses.length} versets de Jean 3`, 'info');
                    } else {
                        log('âš ï¸ API Bible non disponible (mode hors ligne)', 'info');
                    }
                } catch (error) {
                    log('âš ï¸ API Bible non accessible', 'info');
                }
            } else {
                log('âŒ Fonction fetchFromBibleAPI non trouvÃ©e', 'error');
            }
        }

        async function runAllTests() {
            log('ðŸš€ Lancement de tous les tests...', 'info');
            document.getElementById('results').innerHTML = '';
            
            await testBibleData();
            testSyncManager();
            testFavorites();
            testNotes();
            await testAPI();
            
            log('ðŸŽ‰ Tests terminÃ©s!', 'success');
        }

        // Test automatique au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ðŸ”„ Initialisation des tests...', 'info');
                testSyncManager();
            }, 1000);
        });
    </script>
</body>
</html>