<style>
  .settings-heading{display:flex;align-items:center;gap:10px;margin-bottom:20px}
  .settings-section{background:rgba(255,255,255,0.03);padding:20px;border-radius:12px;margin:15px 0;border:1px solid rgba(255,255,255,0.08)}
  .section-title{font-size:18px;font-weight:600;margin-bottom:15px;display:flex;align-items:center;gap:8px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .field{margin:12px 0}
  label{display:block;margin-bottom:6px;font-weight:500}
  select,input[type=text],input[type=email],input[type=number]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.04);color:white;width:100%;max-width:420px}
  .small{font-size:12px;color:rgba(255,255,255,0.7);margin-top:4px}
  .btn{padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:transparent;color:white;cursor:pointer;transition:all 0.3s}
  .btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.2)}
  .btn.primary{background:linear-gradient(135deg,#6a11cb,#2575fc);border:none}
  .btn.danger{background:linear-gradient(135deg,#ff5252,#ff7043);border:none}
  .btn.success{background:linear-gradient(135deg,#43a047,#66bb6a);border:none}
</style>

<h2 class="settings-heading"><svg class="icon-svg" aria-hidden="true"><use href="#icon-settings"></use></svg> <span>Param√®tres</span></h2>

<!-- Section Apparence -->
<div class="settings-section">
  <div class="section-title">üé® Apparence</div>
  
  <div class="field">
  <label>üé® Th√®me</label>
  <div class="row">
    <select id="themeSelect">
      <option value="dark">Sombre</option>
      <option value="light">Clair</option>
    </select>
    <button class="btn" id="applyTheme">Appliquer</button>
    <div class="small">(Le th√®me est enregistr√© localement)</div>
  </div>
</div>

<div class="field">
  <label>üåç Langue</label>
  <div class="row">
    <select id="langSelect">
      <option value="fr">Fran√ßais</option>
      <option value="en">Anglais</option>
    </select>
    <button class="btn" id="applyLang">Appliquer</button>
    <div class="small">(Changement de langue pour l'interface future)</div>
  </div>
</div>

<div class="field">
  <label>üî† Police</label>
  <div class="row">
    <select id="fontSelect">
      <option value="standard">Standard</option>
      <option value="large">Large</option>
      <option value="hand">Manuscrite</option>
    </select>
    <button class="btn" id="applyFont">Appliquer</button>
    <div class="small">(Ajuste la taille et le style de police)</div>
  </div>
</div>
</div>

<!-- Section Notifications -->
<div class="settings-section">
  <div class="section-title">üîî Notifications & Rappels</div>
  
  <div class="field">
  <label>Notifications</label>
  <div class="row">
    <input type="checkbox" id="notifChk"> <label for="notifChk">Activer les notifications</label>
    <div class="small">(Stock√© localement)</div>
  </div>
</div>

  <div class="field">
  <label>Rappels de pri√®re</label>
  <div class="row">
    <input type="time" id="prayerTime" style="max-width:150px"> 
    <button class="btn primary" id="setPrayerReminder">D√©finir rappel</button>
    <div class="small">(Rappel quotidien pour la pri√®re)</div>
  </div>
</div>

  <div class="field">
  <label>Lecture biblique quotidienne</label>
  <div class="row">
    <input type="checkbox" id="dailyBibleChk"> <label for="dailyBibleChk">Activer les rappels de lecture</label>
    <div class="small">(Notification pour lire la Bible chaque jour)</div>
  </div>
</div>
</div>

<!-- Section Contr√¥le Parental -->
<div class="settings-section">
  <div class="section-title">üßí Contr√¥le Parental</div>
  
  <div class="field">
  <label>Mode enfant</label>
  <div class="row">
    <input type="checkbox" id="childChk"> <label for="childChk">Activer le mode enfant</label>
    <div class="small">(Masque les sections inappropri√©es)</div>
  </div>
</div>

  <div class="field">
  <label>Limite de temps d'√©cran</label>
  <div class="row">
    <input type="number" id="screenTime" min="0" max="180" placeholder="Minutes" style="max-width:120px">
    <button class="btn" id="setScreenTime">D√©finir</button>
    <div class="small">(Limite quotidienne en minutes)</div>
  </div>
</div>
</div>

<!-- Section Connexion -->
<div class="settings-section">
  <div class="section-title">üì° Connexion & Synchronisation</div>
  
  <div class="field">
  <label>Mode hors-ligne</label>
  <div class="row">
    <input type="checkbox" id="offlineChk"> <label for="offlineChk">Activer le mode hors-ligne</label>
    <div class="small">(Pr√©pare l'app pour un usage r√©duit hors connexion)</div>
  </div>
</div>

  <div class="field">
  <label>Synchronisation automatique</label>
  <div class="row">
    <input type="checkbox" id="autoSyncChk"> <label for="autoSyncChk">Synchroniser automatiquement</label>
    <div class="small">(Sauvegarde automatique des progr√®s)</div>
  </div>
</div>
</div>

<!-- Section Profil -->
<div class="settings-section">
  <div class="section-title">üë§ Profil Utilisateur</div>
  
  <div class="field">
  <label>Nom d'utilisateur</label>
  <div class="row">
    <input type="text" id="editName" placeholder="Changer le nom d'utilisateur">
    <button class="btn primary" id="saveProfileBtn">Enregistrer</button>
    <span class="small" id="profileMsg"></span>
  </div>
</div>

  <div class="field">
  <label>Email</label>
  <div class="row">
    <input type="email" id="editEmail" placeholder="Changer l'email">
    <button class="btn primary" id="saveEmailBtn">Enregistrer</button>
    <span class="small" id="emailMsg"></span>
  </div>
</div>

  <div class="field">
  <label>Photo de profil</label>
  <div class="row">
    <button class="btn" id="uploadPhotoBtn">üì∑ Choisir une photo</button>
    <div class="small">(Fonctionnalit√© √† venir)</div>
  </div>
</div>
</div>

<!-- Section Confidentialit√© -->
<div class="settings-section">
  <div class="section-title">üîí Confidentialit√© & S√©curit√©</div>
  
  <div class="field">
  <label>Historique de navigation</label>
  <div class="row">
    <button class="btn" id="clearHistoryBtn">Effacer l'historique</button>
    <div class="small">(Supprime l'historique des sections visit√©es)</div>
  </div>
</div>

  <div class="field">
  <label>Partage de donn√©es</label>
  <div class="row">
    <input type="checkbox" id="shareDataChk"> <label for="shareDataChk">Partager les statistiques anonymes</label>
    <div class="small">(Aide √† am√©liorer l'application)</div>
  </div>
</div>
</div>

<!-- Section Avanc√© -->
<div class="settings-section">
  <div class="section-title">‚öôÔ∏è Param√®tres Avanc√©s</div>
  
  <div class="field">
  <label>Version de la Bible par d√©faut</label>
  <div class="row">
    <select id="bibleVersionSelect">
      <option value="LS1910">Louis Segond 1910</option>
      <option value="Darby">Darby</option>
      <option value="KJV">King James Version</option>
    </select>
    <button class="btn" id="applyBibleVersion">Appliquer</button>
  </div>
</div>

  <div class="field">
  <label>R√©initialiser les points</label>
  <div class="row">
    <button class="btn danger" id="resetPointsBtn">R√©initialiser mes points</button>
    <div class="small">(Remet vos points √† z√©ro)</div>
  </div>
</div>

  <div class="field">
  <label>Donn√©es de l'application</label>
  <div class="row">
    <button class="btn danger" id="clearBtn">Effacer les donn√©es (localStorage)</button>
    <div class="small">Attention : cela d√©connectera les utilisateurs et r√©initialisera les points.</div>
  </div>
</div>

<script>
// Initialisation et gestion des pr√©f√©rences
(function(){
  const themeSelect = document.getElementById('themeSelect');
  const applyThemeBtn = document.getElementById('applyTheme');
  const langSelect = document.getElementById('langSelect');
  const applyLangBtn = document.getElementById('applyLang');
  const fontSelect = document.getElementById('fontSelect');
  const applyFontBtn = document.getElementById('applyFont');
  const notifChk = document.getElementById('notifChk');
  const childChk = document.getElementById('childChk');
  const offlineChk = document.getElementById('offlineChk');
  const saveProfileBtn = document.getElementById('saveProfileBtn');
  const editName = document.getElementById('editName');
  const profileMsg = document.getElementById('profileMsg');
  const clearBtn = document.getElementById('clearBtn');

  const defaultPrefs = {
    theme: localStorage.getItem('appTheme') || 'dark',
    lang: localStorage.getItem('appLang') || 'fr',
    font: localStorage.getItem('appFont') || 'standard',
    notifications: JSON.parse(localStorage.getItem('appNotif') || 'false'),
    childMode: JSON.parse(localStorage.getItem('appChild') || 'false'),
    offline: JSON.parse(localStorage.getItem('appOffline') || 'false')
  };

  // Appliquer les pr√©f√©rences √† l'UI
  function applyAll(p){
    themeSelect.value = p.theme; applyTheme(p.theme);
    langSelect.value = p.lang;
    fontSelect.value = p.font; applyFont(p.font);
    notifChk.checked = p.notifications;
    childChk.checked = p.childMode; applyChildMode(p.childMode);
    offlineChk.checked = p.offline;
  }

  function applyTheme(t){
    localStorage.setItem('appTheme', t);
    if(t==='light'){
      document.documentElement.style.setProperty('--bg1','#f6f7fb');
      document.documentElement.style.setProperty('--bg2','#e9eefc');
      document.body.style.color = '#111';
    } else {
      document.documentElement.style.setProperty('--bg1','#6a11cb');
      document.documentElement.style.setProperty('--bg2','#2575fc');
      document.body.style.color = '#fff';
    }
  }

  function applyFont(f){
    localStorage.setItem('appFont', f);
    if(f==='large'){
      document.documentElement.style.setProperty('font-size','18px');
      document.body.style.fontFamily = "'Segoe UI', sans-serif";
    } else if(f==='hand'){
      document.documentElement.style.setProperty('font-size','16px');
      document.body.style.fontFamily = "'Segoe UI', 'Bradley Hand', 'Comic Sans MS', cursive";
    } else {
      document.documentElement.style.setProperty('font-size','15px');
      document.body.style.fontFamily = "'Segoe UI', sans-serif";
    }
  }

  function applyChildMode(on){
    localStorage.setItem('appChild', JSON.stringify(on));
    if(on){
      // masquer certaines sections (ex: jeux)
      document.querySelectorAll('.section[data-key="jeux"], .section[data-key="videos"]').forEach(el=>el.style.display='none');
    } else {
      document.querySelectorAll('.section[data-key="jeux"], .section[data-key="videos"]').forEach(el=>el.style.display='flex');
    }
  }

  // charger et appliquer
  applyAll(defaultPrefs);

  applyThemeBtn.addEventListener('click', ()=>{ applyTheme(themeSelect.value); alert('Th√®me appliqu√©.'); });
  applyLangBtn.addEventListener('click', ()=>{ localStorage.setItem('appLang', langSelect.value); alert('Langue enregistr√©e.'); });
  applyFontBtn.addEventListener('click', ()=>{ applyFont(fontSelect.value); alert('Police appliqu√©e.'); });

  notifChk.addEventListener('change', ()=>{ localStorage.setItem('appNotif', JSON.stringify(notifChk.checked)); alert('Pr√©f√©rence de notification enregistr√©e.'); });
  childChk.addEventListener('change', ()=>{ applyChildMode(childChk.checked); });
  offlineChk.addEventListener('change', ()=>{ localStorage.setItem('appOffline', JSON.stringify(offlineChk.checked)); alert('Mode hors-ligne enregistr√©.'); });

  // Nouveaux gestionnaires
  const setPrayerReminder = document.getElementById('setPrayerReminder');
  const prayerTime = document.getElementById('prayerTime');
  setPrayerReminder?.addEventListener('click', ()=>{ 
    if(prayerTime.value){ localStorage.setItem('prayerReminderTime', prayerTime.value); alert('Rappel de pri√®re d√©fini pour '+prayerTime.value); }
    else alert('Veuillez choisir une heure');
  });

  const dailyBibleChk = document.getElementById('dailyBibleChk');
  dailyBibleChk?.addEventListener('change', ()=>{ localStorage.setItem('dailyBible', JSON.stringify(dailyBibleChk.checked)); });

  const setScreenTime = document.getElementById('setScreenTime');
  const screenTime = document.getElementById('screenTime');
  setScreenTime?.addEventListener('click', ()=>{ 
    if(screenTime.value){ localStorage.setItem('screenTimeLimit', screenTime.value); alert('Limite de temps d√©finie: '+screenTime.value+' minutes'); }
  });

  const autoSyncChk = document.getElementById('autoSyncChk');
  autoSyncChk?.addEventListener('change', ()=>{ localStorage.setItem('autoSync', JSON.stringify(autoSyncChk.checked)); });

  const saveEmailBtn = document.getElementById('saveEmailBtn');
  const editEmail = document.getElementById('editEmail');
  const emailMsg = document.getElementById('emailMsg');
  saveEmailBtn?.addEventListener('click', ()=>{
    const email = editEmail.value.trim();
    if(!email || !email.includes('@')){ emailMsg.textContent = 'Email invalide.'; return; }
    const cu = localStorage.getItem('currentUser');
    if(cu){
      const user = JSON.parse(cu);
      user.email = email;
      localStorage.setItem('currentUser', JSON.stringify(user));
      emailMsg.textContent = 'Email mis √† jour.';
    }
  });

  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  clearHistoryBtn?.addEventListener('click', ()=>{ 
    if(confirm('Effacer l\'historique ?')){ localStorage.removeItem('visitHistory'); alert('Historique effac√©.'); }
  });

  const shareDataChk = document.getElementById('shareDataChk');
  shareDataChk?.addEventListener('change', ()=>{ localStorage.setItem('shareData', JSON.stringify(shareDataChk.checked)); });

  const bibleVersionSelect = document.getElementById('bibleVersionSelect');
  const applyBibleVersion = document.getElementById('applyBibleVersion');
  applyBibleVersion?.addEventListener('click', ()=>{ localStorage.setItem('bibleVersion', bibleVersionSelect.value); alert('Version de la Bible d√©finie: '+bibleVersionSelect.value); });

  const resetPointsBtn = document.getElementById('resetPointsBtn');
  resetPointsBtn?.addEventListener('click', ()=>{
    if(!confirm('R√©initialiser vos points ? Cette action est irr√©versible.')) return;
    const cu = localStorage.getItem('currentUser');
    if(cu){
      const user = JSON.parse(cu);
      user.points = 0; user.completed = 0;
      localStorage.setItem('currentUser', JSON.stringify(user));
      const users = JSON.parse(localStorage.getItem('appUsers')||'[]');
      const idx = users.findIndex(u=>u.email===user.email);
      if(idx!==-1){ users[idx] = user; localStorage.setItem('appUsers', JSON.stringify(users)); }
      alert('Points r√©initialis√©s.');
      location.reload();
    }
  });

  // Charger les valeurs sauvegard√©es
  prayerTime.value = localStorage.getItem('prayerReminderTime') || '';
  dailyBibleChk.checked = JSON.parse(localStorage.getItem('dailyBible') || 'false');
  screenTime.value = localStorage.getItem('screenTimeLimit') || '';
  autoSyncChk.checked = JSON.parse(localStorage.getItem('autoSync') || 'true');
  shareDataChk.checked = JSON.parse(localStorage.getItem('shareData') || 'false');
  bibleVersionSelect.value = localStorage.getItem('bibleVersion') || 'LS1910';

  saveProfileBtn.addEventListener('click', ()=>{
    const name = editName.value.trim();
    if(!name){ profileMsg.textContent = 'Entrez un nom.'; return; }
    const cu = localStorage.getItem('currentUser');
    if(cu){
      const user = JSON.parse(cu);
      user.username = name;
      localStorage.setItem('currentUser', JSON.stringify(user));
      const users = JSON.parse(localStorage.getItem('appUsers')||'[]');
      const idx = users.findIndex(u=>u.email===user.email);
      if(idx!==-1){ users[idx].username = name; localStorage.setItem('appUsers', JSON.stringify(users)); }
      profileMsg.textContent = 'Profil mis √† jour.';
      const display = document.getElementById('userDisplayName'); if(display) display.textContent = name;
    } else {
      profileMsg.textContent = 'Aucun utilisateur connect√©.';
    }
  });

  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Effacer toutes les donn√©es locales ? Cette op√©ration est irr√©versible.')) return;
    localStorage.clear();
    alert('Donn√©es effac√©es. Rechargement de la page.');
    location.reload();
  });

})();
</script>