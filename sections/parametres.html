<style>
  .section-heading { display:flex; align-items:center; gap:10px; }
  .section-heading .icon-svg { width:28px; height:28px; transition: transform 0.18s ease; }
  .section-heading:hover .icon-svg { transform: scale(1.12); }
  .settings-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 12px; margin: 15px 0; }
  .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
  .settings-item:last-child { border-bottom: none; }
  .toggle-switch { position: relative; width: 60px; height: 30px; background: rgba(255,255,255,0.2); border-radius: 15px; cursor: pointer; transition: background 0.3s; }
  .toggle-switch.active { background: #4caf50; }
  .toggle-switch::after { content: ''; position: absolute; width: 26px; height: 26px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: left 0.3s; }
  .toggle-switch.active::after { left: 32px; }
</style>

<h2 class="section-heading"><svg class="icon-svg" aria-hidden="true"><use href="#icon-settings"></use></svg> <span>âš™ï¸ ParamÃ¨tres</span></h2>

<div class="settings-card">
  <h3>ğŸ¨ Apparence</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">ThÃ¨me de couleur</div>
      <div style="font-size: 12px; opacity: 0.7;">Choisissez votre thÃ¨me prÃ©fÃ©rÃ©</div>
    </div>
    <select id="colorTheme" onchange="changeColorTheme()" style="padding: 8px 12px; border-radius: 6px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
      <option value="purple">Violet (DÃ©faut)</option>
      <option value="blue">Bleu</option>
      <option value="green">Vert</option>
      <option value="orange">Orange</option>
      <option value="red">Rouge</option>
      <option value="dark">Noir</option>
    </select>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Taille de police</div>
      <div style="font-size: 12px; opacity: 0.7;">Ajuster la taille du texte</div>
    </div>
    <select id="fontSize" onchange="changeFontSize()" style="padding: 8px 12px; border-radius: 6px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);">
      <option value="small">Petit</option>
      <option value="medium" selected>Moyen</option>
      <option value="large">Grand</option>
      <option value="xlarge">TrÃ¨s grand</option>
    </select>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Mode sombre/clair</div>
      <div style="font-size: 12px; opacity: 0.7;">Changer le thÃ¨me de l'application</div>
    </div>
    <div class="toggle-switch" id="themeToggle" onclick="toggleTheme()"></div>
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ”” Notifications</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Rappels de priÃ¨re</div>
      <div style="font-size: 12px; opacity: 0.7;">Recevoir des rappels quotidiens</div>
    </div>
    <div class="toggle-switch" id="prayerNotif" onclick="toggleSetting('prayerNotif')"></div>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Verset du jour</div>
      <div style="font-size: 12px; opacity: 0.7;">Notification quotidienne du verset</div>
    </div>
    <div class="toggle-switch" id="verseNotif" onclick="toggleSetting('verseNotif')"></div>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Heure des rappels</div>
      <div style="font-size: 12px; opacity: 0.7;">DÃ©finir l'heure des notifications</div>
    </div>
    <input type="time" id="notifTime" value="07:00" style="padding: 8px; border-radius: 6px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2);" onchange="saveNotifTime()">
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ”Š Audio</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Lecture automatique</div>
      <div style="font-size: 12px; opacity: 0.7;">Lire automatiquement les priÃ¨res</div>
    </div>
    <div class="toggle-switch" id="autoPlay" onclick="toggleSetting('autoPlay')"></div>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Volume</div>
      <div style="font-size: 12px; opacity: 0.7;">Ajuster le volume audio</div>
    </div>
    <input type="range" id="volumeControl" min="0" max="100" value="80" style="width: 120px;" onchange="saveVolume()">
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ContrÃ´le parental</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Mode enfant</div>
      <div style="font-size: 12px; opacity: 0.7;">Contenu adaptÃ© aux enfants</div>
    </div>
    <div class="toggle-switch" id="childMode" onclick="toggleSetting('childMode')"></div>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Code PIN</div>
      <div style="font-size: 12px; opacity: 0.7;">ProtÃ©ger l'accÃ¨s aux paramÃ¨tres</div>
    </div>
    <button onclick="setPIN()" style="background: #6a11cb; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">DÃ©finir</button>
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ“± Partage</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Partager l'application</div>
      <div style="font-size: 12px; opacity: 0.7;">Inviter vos amis</div>
    </div>
    <button onclick="shareApp()" style="background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">ğŸ“¤ Partager</button>
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ“… Calendrier liturgique</h3>
  <div style="padding: 15px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-top: 10px;">
    <div style="font-weight: bold; margin-bottom: 10px;">Prochaines fÃªtes chrÃ©tiennes</div>
    <div id="liturgicalCalendar"></div>
  </div>
</div>

<div class="settings-card">
  <h3>ğŸ’¾ DonnÃ©es</h3>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Sauvegarder mes donnÃ©es</div>
      <div style="font-size: 12px; opacity: 0.7;">Exporter vos donnÃ©es</div>
    </div>
    <button onclick="exportData()" style="background: #4caf50; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">ğŸ’¾ Exporter</button>
  </div>
  <div class="settings-item">
    <div>
      <div style="font-weight: bold;">Effacer le cache</div>
      <div style="font-size: 12px; opacity: 0.7;">LibÃ©rer de l'espace</div>
    </div>
    <button onclick="clearCache()" style="background: #ff9800; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer;">ğŸ—‘ï¸ Effacer</button>
  </div>
</div>

<script>
  // Charger les paramÃ¨tres sauvegardÃ©s
  function loadSettings() {
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    
    if(settings.theme === 'light') {
      document.getElementById('themeToggle').classList.add('active');
    }
    
    if(settings.colorTheme) {
      document.getElementById('colorTheme').value = settings.colorTheme;
      applyColorTheme(settings.colorTheme);
    }
    
    if(settings.fontSize) {
      document.getElementById('fontSize').value = settings.fontSize;
      applyFontSize(settings.fontSize);
    }
    
    ['prayerNotif', 'verseNotif', 'autoPlay', 'childMode'].forEach(key => {
      if(settings[key]) {
        document.getElementById(key).classList.add('active');
      }
    });
    
    if(settings.notifTime) {
      document.getElementById('notifTime').value = settings.notifTime;
    }
    
    if(settings.volume) {
      document.getElementById('volumeControl').value = settings.volume;
    }
    
    loadLiturgicalCalendar();
  }

  function changeColorTheme() {
    const theme = document.getElementById('colorTheme').value;
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings.colorTheme = theme;
    localStorage.setItem('appSettings', JSON.stringify(settings));
    applyColorTheme(theme);
    alert('âœ… ThÃ¨me appliquÃ© ! Rechargez la page pour voir tous les changements.');
  }
  
  function applyColorTheme(theme) {
    const themes = {
      purple: { bg1: '#6a11cb', bg2: '#2575fc' },
      blue: { bg1: '#1e3c72', bg2: '#2a5298' },
      green: { bg1: '#11998e', bg2: '#38ef7d' },
      orange: { bg1: '#f46b45', bg2: '#eea849' },
      red: { bg1: '#c31432', bg2: '#240b36' },
      dark: { bg1: '#232526', bg2: '#414345' }
    };
    
    const colors = themes[theme] || themes.purple;
    document.body.style.background = `linear-gradient(to right, ${colors.bg1}, ${colors.bg2})`;
  }
  
  function changeFontSize() {
    const size = document.getElementById('fontSize').value;
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings.fontSize = size;
    localStorage.setItem('appSettings', JSON.stringify(settings));
    applyFontSize(size);
  }
  
  function applyFontSize(size) {
    const sizes = {
      small: '14px',
      medium: '16px',
      large: '18px',
      xlarge: '20px'
    };
    document.body.style.fontSize = sizes[size] || sizes.medium;
  }
  
  function toggleTheme() {
    const toggle = document.getElementById('themeToggle');
    toggle.classList.toggle('active');
    
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings.theme = toggle.classList.contains('active') ? 'light' : 'dark';
    localStorage.setItem('appSettings', JSON.stringify(settings));
    
    if(settings.theme === 'light') {
      document.body.style.background = 'linear-gradient(to right, #f5f5f5, #e0e0e0)';
      document.body.style.color = '#333';
    } else {
      const colorTheme = settings.colorTheme || 'purple';
      applyColorTheme(colorTheme);
      document.body.style.color = 'white';
    }
  }

  function toggleSetting(key) {
    const toggle = document.getElementById(key);
    toggle.classList.toggle('active');
    
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings[key] = toggle.classList.contains('active');
    localStorage.setItem('appSettings', JSON.stringify(settings));
    
    if(settings[key]) {
      alert(`âœ… ${key === 'prayerNotif' ? 'Rappels de priÃ¨re' : key === 'verseNotif' ? 'Verset du jour' : key === 'autoPlay' ? 'Lecture automatique' : 'Mode enfant'} activÃ©`);
    }
  }

  function saveNotifTime() {
    const time = document.getElementById('notifTime').value;
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings.notifTime = time;
    localStorage.setItem('appSettings', JSON.stringify(settings));
    alert(`âœ… Heure des rappels dÃ©finie Ã  ${time}`);
  }

  function saveVolume() {
    const volume = document.getElementById('volumeControl').value;
    const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
    settings.volume = volume;
    localStorage.setItem('appSettings', JSON.stringify(settings));
  }

  function setPIN() {
    const pin = prompt('DÃ©finir un code PIN (4 chiffres):');
    if(pin && pin.length === 4 && !isNaN(pin)) {
      const settings = JSON.parse(localStorage.getItem('appSettings')) || {};
      settings.pin = pin;
      localStorage.setItem('appSettings', JSON.stringify(settings));
      alert('âœ… Code PIN dÃ©fini avec succÃ¨s');
    } else {
      alert('âš ï¸ Code PIN invalide. Utilisez 4 chiffres.');
    }
  }

  function shareApp() {
    const shareText = 'âœ¨ DÃ©couvrez AUTOMATISATION - Votre compagnon spirituel quotidien ! ğŸ™\n\nPriÃ¨res, Bible, Quiz et plus encore.\n\nhttps://franckzeregbe.github.io/AUTOMATISATION';
    
    if(navigator.share) {
      navigator.share({
        title: 'AUTOMATISATION',
        text: shareText,
        url: 'https://franckzeregbe.github.io/AUTOMATISATION'
      }).catch(() => {});
    } else {
      navigator.clipboard.writeText(shareText);
      alert('âœ… Lien copiÃ© ! Partagez-le avec vos amis.');
    }
  }

  function loadLiturgicalCalendar() {
    const events = [
      { date: '2024-12-25', name: 'ğŸ„ NoÃ«l - Naissance de JÃ©sus' },
      { date: '2025-01-01', name: 'âœ¨ Nouvel An' },
      { date: '2025-04-20', name: 'ğŸŒ… PÃ¢ques - RÃ©surrection' },
      { date: '2025-05-29', name: 'ğŸ•Šï¸ PentecÃ´te' },
      { date: '2025-12-25', name: 'ğŸ„ NoÃ«l - Naissance de JÃ©sus' }
    ];
    
    const today = new Date();
    const upcoming = events.filter(e => new Date(e.date) >= today).slice(0, 3);
    
    let html = '';
    upcoming.forEach(event => {
      const eventDate = new Date(event.date);
      const daysUntil = Math.ceil((eventDate - today) / (1000 * 60 * 60 * 24));
      html += `<div style="padding: 10px; margin: 5px 0; background: rgba(255,255,255,0.05); border-radius: 6px; border-left: 3px solid #ffeb3b;">
        <div style="font-weight: bold;">${event.name}</div>
        <div style="font-size: 12px; opacity: 0.7;">${eventDate.toLocaleDateString('fr-FR')} (dans ${daysUntil} jours)</div>
      </div>`;
    });
    
    document.getElementById('liturgicalCalendar').innerHTML = html || '<p style="opacity: 0.7;">Aucun Ã©vÃ©nement Ã  venir</p>';
  }

  function exportData() {
    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
    if(!currentUser) return;
    
    const data = {
      user: currentUser,
      stats: JSON.parse(localStorage.getItem('userStats_' + currentUser.phone)) || {},
      favorites: JSON.parse(localStorage.getItem('favorites_' + currentUser.phone)) || [],
      notes: JSON.parse(localStorage.getItem('notes_' + currentUser.phone)) || [],
      goals: JSON.parse(localStorage.getItem('goals_' + currentUser.phone)) || [],
      settings: JSON.parse(localStorage.getItem('appSettings')) || {}
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `automatisation_backup_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    alert('âœ… DonnÃ©es exportÃ©es avec succÃ¨s !');
  }

  function clearCache() {
    if(confirm('âš ï¸ ÃŠtes-vous sÃ»r de vouloir effacer le cache ?\n\nCela ne supprimera pas vos donnÃ©es personnelles.')) {
      // Effacer uniquement les donnÃ©es temporaires
      sessionStorage.clear();
      alert('âœ… Cache effacÃ© avec succÃ¨s !');
    }
  }

  // Charger les paramÃ¨tres au chargement de la page
  loadSettings();
</script>
