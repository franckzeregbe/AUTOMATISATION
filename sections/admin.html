<div id="adminPanel">
  <h2>ğŸ” Tableau de bord Administrateur</h2>
  
  <div id="adminAccess" style="display: none;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
      <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <h3 style="margin: 0 0 10px 0; font-size: 32px;" id="totalUsers">0</h3>
        <p style="margin: 0; opacity: 0.9;">ğŸ‘¥ Utilisateurs inscrits</p>
      </div>
      
      <div style="background: linear-gradient(135deg, #f093fb, #f5576c); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <h3 style="margin: 0 0 10px 0; font-size: 32px;" id="totalAppointments">0</h3>
        <p style="margin: 0; opacity: 0.9;">ğŸ“… Rendez-vous</p>
      </div>
      
      <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
        <h3 style="margin: 0 0 10px 0; font-size: 32px;" id="pendingAppointments">0</h3>
        <p style="margin: 0; opacity: 0.9;">â³ En attente</p>
      </div>
    </div>
    
    <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 12px; margin: 20px 0;">
      <h3>ğŸ“‹ Gestion des rendez-vous</h3>
      <div id="adminAppointmentsList"></div>
    </div>
    
    <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 12px; margin: 20px 0;">
      <h3>ğŸ‘¥ Liste des utilisateurs</h3>
      <div id="adminUsersList"></div>
    </div>
    
    <div style="background: rgba(255,255,255,0.05); padding: 25px; border-radius: 12px; margin: 20px 0;">
      <h3>ğŸ“ Gestion du contenu</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button onclick="showContentManager('videos')" style="padding: 10px 20px; background: linear-gradient(135deg, #ff8a65, #ff5252); border: none; color: white; border-radius: 8px; cursor: pointer;">ğŸ¬ VidÃ©os</button>
        <button onclick="showContentManager('testimonies')" style="padding: 10px 20px; background: linear-gradient(135deg, #ffb74d, #ff9800); border: none; color: white; border-radius: 8px; cursor: pointer;">ğŸ’¬ TÃ©moignages</button>
        <button onclick="showContentManager('verses')" style="padding: 10px 20px; background: linear-gradient(135deg, #66bb6a, #43a047); border: none; color: white; border-radius: 8px; cursor: pointer;">ğŸ“– Versets</button>
      </div>
      <div id="contentManagerArea"></div>
    </div>
  </div>
  
  <div id="adminLogin" style="max-width: 400px; margin: 50px auto; background: rgba(255,255,255,0.05); padding: 30px; border-radius: 12px;">
    <h3 style="text-align: center; margin-bottom: 20px;">AccÃ¨s Administrateur</h3>
    <input type="password" id="adminPassword" placeholder="Mot de passe administrateur" style="width: 100%; padding: 12px; border-radius: 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; margin-bottom: 15px;">
    <button onclick="adminLogin()" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #6a11cb, #2575fc); color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer;">Se connecter</button>
    <p style="text-align: center; margin-top: 15px; font-size: 12px; opacity: 0.6;">RÃ©servÃ© aux administrateurs uniquement</p>
  </div>
</div>

<script>
const ADMIN_PASSWORD = 'admin2024';

function checkAdminAccess() {
  if(currentUser && currentUser.isAdmin) {
    document.getElementById('adminLogin').style.display = 'none';
    document.getElementById('adminAccess').style.display = 'block';
    loadAdminData();
  } else {
    document.getElementById('adminLogin').style.display = 'block';
    document.getElementById('adminAccess').style.display = 'none';
  }
}

function adminLogin() {
  const password = document.getElementById('adminPassword').value;
  
  if(password === ADMIN_PASSWORD) {
    currentUser.isAdmin = true;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    let users = JSON.parse(localStorage.getItem('appUsers')) || [];
    users = users.map(u => u.phone === currentUser.phone ? currentUser : u);
    localStorage.setItem('appUsers', JSON.stringify(users));
    
    alert('âœ… AccÃ¨s administrateur accordÃ©');
    checkAdminAccess();
  } else {
    alert('âŒ Mot de passe incorrect');
  }
}

function loadAdminData() {
  const users = JSON.parse(localStorage.getItem('appUsers')) || [];
  const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
  
  document.getElementById('totalUsers').textContent = users.length;
  document.getElementById('totalAppointments').textContent = appointments.length;
  document.getElementById('pendingAppointments').textContent = appointments.filter(a => a.status === 'pending').length;
  
  loadAdminAppointments();
  loadAdminUsers();
}

function loadAdminAppointments() {
  const appointments = JSON.parse(localStorage.getItem('appointments')) || [];
  const list = document.getElementById('adminAppointmentsList');
  
  if(appointments.length === 0) {
    list.innerHTML = '<p style="opacity: 0.6; text-align: center;">Aucun rendez-vous</p>';
    return;
  }
  
  const statusLabels = {
    pending: 'â³ En attente',
    confirmed: 'âœ… ConfirmÃ©',
    cancelled: 'âŒ AnnulÃ©',
    completed: 'âœ”ï¸ TerminÃ©'
  };
  
  const sortedAppointments = appointments.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
  
  list.innerHTML = sortedAppointments.map(a => `
    <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 3px solid ${a.status === 'pending' ? '#ff9800' : a.status === 'confirmed' ? '#4caf50' : '#666'};">
      <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
        <div>
          <strong style="font-size: 16px;">${a.userName}</strong>
          <p style="margin: 5px 0; opacity: 0.8; font-size: 14px;">ğŸ“± ${a.userPhone}</p>
        </div>
        <span style="font-size: 12px; padding: 4px 8px; background: rgba(106,17,203,0.3); border-radius: 4px;">${statusLabels[a.status]}</span>
      </div>
      <p style="margin: 5px 0;"><strong>Type:</strong> ${a.type}</p>
      <p style="margin: 5px 0;"><strong>Date:</strong> ${new Date(a.date).toLocaleDateString('fr-FR')} Ã  ${a.time}</p>
      ${a.message ? `<p style="margin: 5px 0; opacity: 0.7; font-size: 14px;"><strong>Message:</strong> ${a.message}</p>` : ''}
      <p style="margin: 5px 0; opacity: 0.6; font-size: 12px;">CrÃ©Ã© le ${new Date(a.createdAt).toLocaleString('fr-FR')}</p>
      
      ${a.status === 'pending' ? `
        <div style="margin-top: 10px; display: flex; gap: 10px;">
          <button onclick="updateAppointmentStatus(${a.id}, 'confirmed')" style="flex: 1; padding: 8px; background: #4caf50; border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px;">âœ… Confirmer</button>
          <button onclick="updateAppointmentStatus(${a.id}, 'cancelled')" style="flex: 1; padding: 8px; background: #ff5252; border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px;">âŒ Annuler</button>
        </div>
      ` : ''}
      
      ${a.status === 'confirmed' ? `
        <button onclick="updateAppointmentStatus(${a.id}, 'completed')" style="margin-top: 10px; width: 100%; padding: 8px; background: #2196f3; border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 13px;">âœ”ï¸ Marquer comme terminÃ©</button>
      ` : ''}
    </div>
  `).join('');
}

function loadAdminUsers() {
  const users = JSON.parse(localStorage.getItem('appUsers')) || [];
  const list = document.getElementById('adminUsersList');
  
  if(users.length === 0) {
    list.innerHTML = '<p style="opacity: 0.6; text-align: center;">Aucun utilisateur</p>';
    return;
  }
  
  const sortedUsers = users.sort((a, b) => new Date(b.lastLogin) - new Date(a.lastLogin));
  
  list.innerHTML = sortedUsers.map(u => `
    <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
      <div>
        <strong style="font-size: 16px;">${u.fullname}</strong>
        <p style="margin: 5px 0; opacity: 0.8; font-size: 14px;">ğŸ“± ${u.phone}</p>
        ${u.email ? `<p style="margin: 5px 0; opacity: 0.7; font-size: 13px;">ğŸ“§ ${u.email}</p>` : ''}
        <p style="margin: 5px 0; opacity: 0.6; font-size: 12px;">Inscrit le ${u.joinDate}</p>
        <p style="margin: 5px 0; opacity: 0.6; font-size: 12px;">DerniÃ¨re connexion: ${new Date(u.lastLogin).toLocaleString('fr-FR')}</p>
      </div>
      <div style="text-align: right;">
        <p style="margin: 5px 0;"><strong>${u.points || 0}</strong> points</p>
        ${u.isAdmin ? '<span style="background: #ff9800; padding: 4px 8px; border-radius: 4px; font-size: 12px;">ğŸ‘‘ Admin</span>' : ''}
      </div>
    </div>
  `).join('');
}

function updateAppointmentStatus(id, status) {
  let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
  appointments = appointments.map(a => a.id === id ? {...a, status} : a);
  localStorage.setItem('appointments', JSON.stringify(appointments));
  
  const messages = {
    confirmed: 'âœ… Rendez-vous confirmÃ©',
    cancelled: 'âŒ Rendez-vous annulÃ©',
    completed: 'âœ”ï¸ Rendez-vous marquÃ© comme terminÃ©'
  };
  
  alert(messages[status]);
  loadAdminData();
}

// Gestion du contenu
function showContentManager(type) {
  const area = document.getElementById('contentManagerArea');
  
  if(type === 'videos') {
    const videos = JSON.parse(localStorage.getItem('adminVideos')) || [];
    area.innerHTML = `
      <h4>ğŸ¬ Gestion des vidÃ©os</h4>
      <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 15px 0;">
        <input type="text" id="videoTitle" placeholder="Titre de la vidÃ©o" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
        <input type="text" id="videoUrl" placeholder="URL YouTube (ex: https://www.youtube.com/watch?v=...)" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
        <button onclick="addVideo()" style="padding: 10px 20px; background: #4caf50; border: none; color: white; border-radius: 6px; cursor: pointer; margin-top: 10px;">â• Ajouter</button>
      </div>
      <div id="videosList">${videos.map((v, i) => `
        <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 6px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong>${v.title}</strong>
            <p style="margin: 5px 0; opacity: 0.7; font-size: 12px;">${v.url}</p>
          </div>
          <button onclick="deleteVideo(${i})" style="padding: 6px 12px; background: #ff5252; border: none; color: white; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸</button>
        </div>
      `).join('')}</div>
    `;
  } else if(type === 'testimonies') {
    const testimonies = JSON.parse(localStorage.getItem('testimonies')) || [];
    area.innerHTML = `
      <h4>ğŸ’¬ Gestion des tÃ©moignages</h4>
      <p style="opacity: 0.7; font-size: 14px; margin-bottom: 15px;">ModÃ©rer les tÃ©moignages publiÃ©s par les utilisateurs</p>
      <div id="testimoniesList">${testimonies.map((t, i) => `
        <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #ffeb3b;">
          <div style="display: flex; justify-content: space-between; align-items: start;">
            <div style="flex: 1;">
              <strong style="color: #ffeb3b;">${t.title}</strong>
              <p style="margin: 5px 0; opacity: 0.7; font-size: 12px;">ğŸ‘¤ ${t.author} â€¢ ${t.date}</p>
              <p style="margin: 10px 0; opacity: 0.9; font-size: 14px;">${t.content.substring(0, 150)}${t.content.length > 150 ? '...' : ''}</p>
            </div>
            <button onclick="deleteTestimonyAdmin(${i})" style="padding: 6px 12px; background: #ff5252; border: none; color: white; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('')}</div>
    `;
  } else if(type === 'verses') {
    const verses = JSON.parse(localStorage.getItem('adminVerses')) || [];
    area.innerHTML = `
      <h4>ğŸ“– Gestion des versets du jour</h4>
      <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin: 15px 0;">
        <textarea id="verseText" placeholder="Texte du verset" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; min-height: 80px;"></textarea>
        <input type="text" id="verseRef" placeholder="RÃ©fÃ©rence (ex: Jean 3:16)" style="width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white;">
        <button onclick="addVerse()" style="padding: 10px 20px; background: #4caf50; border: none; color: white; border-radius: 6px; cursor: pointer; margin-top: 10px;">â• Ajouter</button>
      </div>
      <div id="versesList">${verses.map((v, i) => `
        <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 6px; margin: 8px 0; display: flex; justify-content: space-between; align-items: start;">
          <div style="flex: 1;">
            <p style="margin: 0 0 5px 0; font-style: italic;">${v.text}</p>
            <p style="margin: 0; opacity: 0.7; font-size: 12px;">- ${v.ref}</p>
          </div>
          <button onclick="deleteVerse(${i})" style="padding: 6px 12px; background: #ff5252; border: none; color: white; border-radius: 4px; cursor: pointer;">ğŸ—‘ï¸</button>
        </div>
      `).join('')}</div>
    `;
  }
}

function addVideo() {
  const title = document.getElementById('videoTitle').value.trim();
  const url = document.getElementById('videoUrl').value.trim();
  
  if(!title || !url) {
    alert('âš ï¸ Veuillez remplir tous les champs');
    return;
  }
  
  const videos = JSON.parse(localStorage.getItem('adminVideos')) || [];
  videos.push({ title, url, addedAt: new Date().toISOString() });
  localStorage.setItem('adminVideos', JSON.stringify(videos));
  
  alert('âœ… VidÃ©o ajoutÃ©e avec succÃ¨s');
  showContentManager('videos');
}

function deleteVideo(index) {
  if(!confirm('âš ï¸ Supprimer cette vidÃ©o ?')) return;
  
  const videos = JSON.parse(localStorage.getItem('adminVideos')) || [];
  videos.splice(index, 1);
  localStorage.setItem('adminVideos', JSON.stringify(videos));
  
  alert('âœ… VidÃ©o supprimÃ©e');
  showContentManager('videos');
}

function deleteTestimonyAdmin(index) {
  if(!confirm('âš ï¸ Supprimer ce tÃ©moignage ?')) return;
  
  const testimonies = JSON.parse(localStorage.getItem('testimonies')) || [];
  testimonies.splice(index, 1);
  localStorage.setItem('testimonies', JSON.stringify(testimonies));
  
  alert('âœ… TÃ©moignage supprimÃ©');
  showContentManager('testimonies');
}

function addVerse() {
  const text = document.getElementById('verseText').value.trim();
  const ref = document.getElementById('verseRef').value.trim();
  
  if(!text || !ref) {
    alert('âš ï¸ Veuillez remplir tous les champs');
    return;
  }
  
  const verses = JSON.parse(localStorage.getItem('adminVerses')) || [];
  verses.push({ text, ref, addedAt: new Date().toISOString() });
  localStorage.setItem('adminVerses', JSON.stringify(verses));
  
  alert('âœ… Verset ajoutÃ© avec succÃ¨s');
  showContentManager('verses');
}

function deleteVerse(index) {
  if(!confirm('âš ï¸ Supprimer ce verset ?')) return;
  
  const verses = JSON.parse(localStorage.getItem('adminVerses')) || [];
  verses.splice(index, 1);
  localStorage.setItem('adminVerses', JSON.stringify(verses));
  
  alert('âœ… Verset supprimÃ©');
  showContentManager('verses');
}

// Check access on load
checkAdminAccess();
</script>
